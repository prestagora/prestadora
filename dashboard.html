<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Plataforma de Marketing</title>

<!-- Chart.js para gráfico -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        margin: 0;
        background: #f4f6f9;
        font-family: Arial, sans-serif;
    }

    /* MENU LATERAL */
    .sidebar {
        width: 250px;
        height: 100vh;
        background: #0d6efd;
        color: #fff;
        position: fixed;
        left: 0;
        top: 0;
        padding-top: 30px;
    }

    .sidebar h2 {
        text-align: center;
        margin-bottom: 30px;
        font-size: 20px;
    }

    .sidebar a {
        display: block;
        padding: 15px 20px;
        color: #fff;
        text-decoration: none;
        font-size: 16px;
    }

    .sidebar a:hover {
        background: #0b5ed7;
        cursor: pointer;
    }

    /* ÁREA PRINCIPAL */
    .main {
        margin-left: 250px;
        padding: 30px;
    }

    .card {
        background: #fff;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 12px rgba(0,0,0,0.1);
        margin-bottom: 25px;
    }

    .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

    .topbar h1 {
        margin: 0;
        font-size: 24px;
        color: #333;
    }

    .btn {
        background: #0d6efd;
        border: none;
        padding: 10px 20px;
        color: #fff;
        border-radius: 6px;
        cursor: pointer;
        font-size: 15px;
    }

    .btn:hover {
        background: #0b5ed7;
    }

    /* DESPESAS */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        text-align: left;
    }

    th {
        background: #eeeeee;
    }

    input[type="text"], input[type="number"] {
        width: 100%;
        padding: 5px;
        border-radius: 4px;
        border: 1px solid #ccc;
        box-sizing: border-box;
    }

    .flex-row {
        display: flex;
        gap: 25px;
        align-items: flex-start;
    }

    .flex-column {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
</style>
</head>

<body>

<!-- MENU LATERAL -->
<div class="sidebar">
    <h2>Marketing ADS</h2>
    <a href="#">Dashboard</a>
    <a href="#contas" onclick="toggleContas()">
        Contas Meta Ads
        <span class="seta" id="seta">▼</span>
    </a>
    <div class="contas-lista" id="listaContas"></div>
    <a href="meusclientes.html">Meus Clientes</a>
    <a href="#">Relatórios</a>
    <a href="#">Configurações</a>
    <a href="#" onclick="sair()">Sair</a>
</div>

<!-- ÁREA PRINCIPAL -->
<div class="main">

    <div class="topbar">
        <h1>Dashboard</h1>
        <div style="display:flex; align-items:center; gap:15px;">
            <!-- Temporizador -->
            <div>
                <span id="tempo" style="font-weight:bold;">00:00:00</span>
            </div>
            <button class="btn" id="btnIniciar" onclick="iniciarTrabalho()">Iniciar Trabalho</button>
            <button class="btn" id="btnParar" onclick="pararTrabalho()" style="display:none;">Parar</button>
            <!-- Conectar Meta Ads -->
            <button class="btn" id="btnMeta" onclick="loginFacebook()">Conectar Meta Ads</button>
        </div>
    </div>

    <div class="card">
        <h3>Bem-vindo à Plataforma de Marketing</h3>
        <p>Gerencie suas contas, campanhas e relatórios de forma automatizada.</p>
    </div>

    <!-- DESPESAS E GRÁFICO -->
    <div class="flex-row">
        <div class="card" style="flex:1;">
            <h3>Minhas Despesas</h3>
            <div class="flex-column">
                <input type="text" id="descricao" placeholder="Descrição da despesa">
                <input type="number" id="valorDespesa" placeholder="Valor (R$)">
                <button class="btn" onclick="adicionarDespesa()">Adicionar Despesa</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Descrição</th>
                        <th>Valor (R$)</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="tabelaDespesas"></tbody>
            </table>
        </div>

        <div class="card" style="flex:1;">
            <h3>Gráfico Receitas x Despesas</h3>
            <canvas id="grafico" height="300"></canvas>
        </div>
    </div>

</div>

<!-- SDK DO FACEBOOK -->
<script>
window.fbAsyncInit = function () {
    FB.init({
        appId: '1224065886236647',
        cookie: true,
        xfbml: true,
        version: 'v19.0'
    });
};

(function(d, s, id) {
    let js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "https://connect.facebook.net/pt_BR/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

<!-- FUNÇÕES -->
<script>
    // Meta Ads
    function loginFacebook() {
        FB.login(response => {
            if(response.status === 'connected'){
                document.getElementById("btnMeta").innerText = "Conectado ✓";
                carregarContasMeta();
            } else { alert("Você precisa permitir o acesso para continuar."); }
        }, {scope: 'ads_read,ads_management,business_management'});
    }

    function carregarContasMeta() {
        FB.api('/me/adaccounts', response => {
            if(response && !response.error){
                localStorage.setItem("contas_meta", JSON.stringify(response.data));
                mostrarContas();
            } else { alert("Erro ao carregar contas Meta Ads."); }
        });
    }

    function mostrarContas() {
        const lista = document.getElementById("listaContas");
        lista.innerHTML = "";
        const contas = JSON.parse(localStorage.getItem("contas_meta") || "[]");
        contas.forEach(conta => {
            lista.innerHTML += `<div class="conta-item">• ${conta.name} (${conta.account_id})</div>`;
        });
    }

    function toggleContas() {
        const lista = document.getElementById("listaContas");
        const seta = document.getElementById("seta");
        const aberto = lista.style.display === "block";
        lista.style.display = aberto ? "none" : "block";
        seta.style.transform = aberto ? "rotate(0deg)" : "rotate(180deg)";
    }

    window.onload = function() {
        if(localStorage.getItem("contas_meta")){
            document.getElementById("btnMeta").innerText = "Conectado ✓";
            mostrarContas();
        }
        atualizarGrafico();
    }

    function sair() {
        localStorage.clear();
        alert("Você saiu da plataforma.");
        location.reload();
    }

    // Temporizador
    let cronometro;
    let segundos = 0;

    function formatarTempo(segundos){
        const h = String(Math.floor(segundos/3600)).padStart(2,'0');
        const m = String(Math.floor((segundos%3600)/60)).padStart(2,'0');
        const s = String(segundos%60).padStart(2,'0');
        return `${h}:${m}:${s}`;
    }

    function iniciarTrabalho(){
        document.getElementById("btnIniciar").style.display="none";
        document.getElementById("btnParar").style.display="inline-block";

        cronometro = setInterval(()=>{
            segundos++;
            document.getElementById("tempo").innerText = formatarTempo(segundos);
        },1000);
    }

    function pararTrabalho(){
        clearInterval(cronometro);
        document.getElementById("btnIniciar").style.display="inline-block";
        document.getElementById("btnParar").style.display="none";
    }

    // Despesas
    function adicionarDespesa(){
        const descricao = document.getElementById("descricao").value;
        const valor = parseFloat(document.getElementById("valorDespesa").value);
        if(!descricao || isNaN(valor)) { alert("Preencha os campos corretamente."); return; }

        let despesas = JSON.parse(localStorage.getItem("despesas") || "[]");
        despesas.push({descricao, valor});
        localStorage.setItem("despesas", JSON.stringify(despesas));

        document.getElementById("descricao").value="";
        document.getElementById("valorDespesa").value="";
        atualizarTabela();
        atualizarGrafico();
    }

    function excluirDespesa(index){
        let despesas = JSON.parse(localStorage.getItem("despesas") || "[]");
        despesas.splice(index,1);
        localStorage.setItem("despesas", JSON.stringify(despesas));
        atualizarTabela();
        atualizarGrafico();
    }

    function atualizarTabela(){
        const tabela = document.getElementById("tabelaDespesas");
        tabela.innerHTML="";
        const despesas = JSON.parse(localStorage.getItem("despesas") || "[]");
        despesas.forEach((d,i)=>{
            tabela.innerHTML+=`
                <tr>
                    <td>${d.descricao}</td>
                    <td>${d.valor.toFixed(2)}</td>
                    <td><button class="btn" style="background:red;padding:5px 10px;" onclick="excluirDespesa(${i})">Excluir</button></td>
                </tr>
            `;
        });
    }

    // Gráfico Receitas x Despesas
    let grafico;
    function atualizarGrafico(){
        const despesas = JSON.parse(localStorage.getItem("despesas") || "[]");
        const totalDespesas = despesas.reduce((acc,d)=>acc+d.valor,0);
        const totalReceitas = 10000; // exemplo de valor recebido no mês, pode ser personalizado
        const ctx = document.getElementById("grafico").getContext("2d");

        if(grafico) grafico.destroy();

        grafico = new Chart(ctx, {
            type:'bar',
            data:{
                labels:['Receitas','Despesas'],
                datasets:[{
                    label:'R$',
                    data:[totalReceitas, totalDespesas],
                    backgroundColor:['#0d6efd','#ff6384']
                }]
            },
            options:{responsive:true, plugins:{legend:{display:false}}}
        });
    }
</script>

</body>
</html>
