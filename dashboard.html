<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Plataforma de Marketing</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    margin: 0;
    background: #f4f6f9;
    font-family: Arial, sans-serif;
}
.sidebar {
    width: 250px;
    height: 100vh;
    background: #0d6efd;
    color: #fff;
    position: fixed;
    left: 0;
    top: 0;
    padding-top: 30px;
}
.sidebar h2 { text-align:center; margin-bottom:30px; font-size:20px; }
.sidebar a { display:block; padding:15px 20px; color:#fff; text-decoration:none; font-size:16px; }
.sidebar a:hover { background:#0b5ed7; cursor:pointer; }
.main { margin-left: 250px; padding: 30px; }
.card { background:#fff; padding:25px; border-radius:10px; box-shadow:0 0 12px rgba(0,0,0,0.1); margin-bottom:25px; }
.topbar { 
    display:flex; 
    justify-content:space-between; 
    align-items:center; 
    margin-bottom:25px;
}
.topbar h1 { margin:0; font-size:24px; color:#333; }

.btn { 
    background:#0d6efd; 
    border:none; 
    padding:10px 20px; 
    color:#fff; 
    border-radius:6px; 
    cursor:pointer; 
    font-size:15px;
    display:flex;
    align-items:center;
    justify-content:center;
}
.btn:hover { background:#0b5ed7; }

/* NOVO ‚Äî GARANTE ALINHAMENTO TOTAL */
.topbar .acoes {
    display:flex;
    align-items:center;
    gap:20px;
}

.timer {
    display:flex;
    align-items:center;
    gap:10px;
    margin:0;
}

.timer span {
    font-size:18px;
    font-weight:bold;
}

.flex-container { display:flex; gap:30px; flex-wrap:wrap; }
.despesas-card, .grafico-card { flex:1; min-width:300px; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
th, td { padding:10px; border-bottom:1px solid #ddd; text-align:left; }
th { background-color:#f0f0f0; }
input[type="text"], input[type="number"], select { width:100%; padding:8px; margin:3px 0; border-radius:5px; border:1px solid #ccc; }
</style>
</head>
<body>

<div class="sidebar">
    <h2>PrestAgora Digital</h2>
    <a href="#">Dashboard</a>
    <a href="#contas" onclick="toggleContas()">Contas Meta Ads <span class="seta" id="seta">‚ñº</span></a>
    <div class="contas-lista" id="listaContas"></div>
    <a href="meusclientes.html">Meus Clientes</a>

    <!-- üîµ AJUSTE FEITO AQUI -->
    <a href="bibliotecaanuncios.html">Biblioteca de an√∫ncios</a>

    <a href="#">Analise de sites</a>
    <a href="#">Analise de redes sociais</a>
    <a href="#" onclick="sair()">Sair</a>
</div>

<div class="main">

    <!-- TOPO COM BOT√ïES ALINHADOS -->
    <div class="topbar">
        <h1>Dashboard</h1>

        <div class="acoes">

            <button class="btn" id="btnMeta" onclick="loginFacebook()">Conectar Meta Ads</button>

            <div class="timer">
                <span id="tempo">00:00:00</span>
                <button class="btn" id="btnIniciar" onclick="iniciarTimer()">Iniciar Trabalho</button>
                <button class="btn" id="btnParar" onclick="pararTimer()" style="display:none;">Parar</button>
            </div>

        </div>
    </div>

    <div class="card">
        <h3>Bem-vindo √† Plataforma de Marketing</h3>
        <p>Gerencie suas contas, campanhas e relat√≥rios de forma automatizada.</p>
    </div>

    <div class="flex-container">
        <!-- Despesas -->
        <div class="despesas-card card">
            <h3>Minhas Despesas</h3>
            <label>Descri√ß√£o</label>
            <input type="text" id="descDespesa" placeholder="Ex: Internet, Software...">
            <label>Categoria</label>
            <input type="text" id="catDespesa" placeholder="Ex: Tecnologia, Escrit√≥rio...">
            <label>Valor (R$)</label>
            <input type="number" id="valDespesa" placeholder="0.00">
            <button class="btn" onclick="adicionarDespesa()">Adicionar Despesa</button>
            <table>
                <thead>
                    <tr><th>Descri√ß√£o</th><th>Categoria</th><th>Valor (R$)</th><th>A√ß√µes</th></tr>
                </thead>
                <tbody id="tabelaDespesas"></tbody>
            </table>
        </div>

        <!-- Receita vs Despesas -->
        <div class="grafico-card card">
            <h3>Receita vs Despesas</h3>
            <canvas id="grafico"></canvas>
        </div>
    </div>

    <!-- TEMPORIZADOR E GR√ÅFICO DE PRODUTIVIDADE -->
    <div class="card">
        <h3>Produtividade (Horas Trabalhadas)</h3>
        <canvas id="graficoProdutividade"></canvas>
    </div>

</div>

<script src="https://connect.facebook.net/pt_BR/sdk.js"></script>

<script>
// ----------------------- DESPESAS -----------------------
let despesas = JSON.parse(localStorage.getItem("despesas") || "[]");

function adicionarDespesa() {
    const desc = descDespesa.value.trim();
    const cat = catDespesa.value.trim();
    const val = parseFloat(valDespesa.value);

    if (!desc || !cat || isNaN(val)) { alert("Preencha todos os campos."); return; }

    despesas.push({ desc, cat, val });
    localStorage.setItem("despesas", JSON.stringify(despesas));

    atualizarTabela();
    atualizarGrafico();

    descDespesa.value = "";
    catDespesa.value = "";
    valDespesa.value = "";
}

function atualizarTabela() {
    tabelaDespesas.innerHTML = "";
    despesas.forEach((d,i)=>{
        tabelaDespesas.innerHTML += `
            <tr>
                <td>${d.desc}</td>
                <td>${d.cat}</td>
                <td>${d.val.toFixed(2)}</td>
                <td><button onclick="removerDespesa(${i})">Excluir</button></td>
            </tr>`;
    });
}

function removerDespesa(i){
    despesas.splice(i,1);
    localStorage.setItem("despesas", JSON.stringify(despesas));
    atualizarTabela();
    atualizarGrafico();
}

// ----------------------- GRAFICO DESPESAS X RECEITA -----------------------
function calcularReceita(){
    const clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
    return clientes.reduce((t,c)=> t + parseFloat(c.valor||0), 0);
}

let graficoChart;
function atualizarGrafico(){
    const receita = calcularReceita();
    const totalDespesas = despesas.reduce((t,d)=> t + d.val, 0);

    const ctx = document.getElementById("grafico").getContext("2d");
    if (graficoChart) graficoChart.destroy();

    graficoChart = new Chart(ctx,{
        type:'bar',
        data:{
            labels:["Receita","Despesas"],
            datasets:[{
                label:"R$",
                data:[receita, totalDespesas],
                backgroundColor:["#0d6efd","#dc3545"]
            }]
        },
        options:{ responsive:true, plugins:{legend:{display:false}} }
    });
}

// ----------------------- TEMPORIZADOR -----------------------
let segundos = 0;
let timerInterval;
let produtividade = JSON.parse(localStorage.getItem("produtividade") || "[]");

function formatar(seg){
    let h = String(Math.floor(seg/3600)).padStart(2,"0");
    let m = String(Math.floor((seg%3600)/60)).padStart(2,"0");
    let s = String(seg%60).padStart(2,"0");
    return `${h}:${m}:${s}`;
}

function iniciarTimer(){
    btnIniciar.style.display = "none";
    btnParar.style.display = "inline-block";

    clearInterval(timerInterval);
    timerInterval = setInterval(()=>{
        segundos++;
        tempo.innerText = formatar(segundos);
    },1000);
}

function pararTimer(){
    clearInterval(timerInterval);

    btnIniciar.style.display = "inline-block";
    btnParar.style.display = "none";

    const horas = segundos / 3600;
    const data = new Date().toLocaleDateString();

    produtividade.push({ data, horas });
    localStorage.setItem("produtividade", JSON.stringify(produtividade));

    segundos = 0;
    tempo.innerText = "00:00:00";

    atualizarGraficoProdutividade();
}

// ----------------------- GRAFICO PRODUTIVIDADE -----------------------
let graficoProd;
function atualizarGraficoProdutividade(){
    const ctx = document.getElementById("graficoProdutividade").getContext("2d");

    const labels = produtividade.map(p=>p.data);
    const valores = produtividade.map(p=>p.horas.toFixed(2));

    if (graficoProd) graficoProd.destroy();

    graficoProd = new Chart(ctx,{
        type:"line",
        data:{
            labels:labels,
            datasets:[{
                label:"Horas Trabalhadas",
                data:valores,
                borderColor:"#0d6efd",
                backgroundColor:"rgba(13,110,253,0.3)",
                tension:0.3,
                fill:true
            }]
        },
        options:{responsive:true}
    });
}

// ----------------------- META ADS LOGIN -----------------------
window.fbAsyncInit = function() {
    FB.init({
        appId: "1224065886236647",
        cookie: true,
        xfbml: true,
        version: "v19.0"
    });
};

function loginFacebook(){
    FB.login(resp=>{
        if(resp.status === "connected"){
            btnMeta.innerText = "Conectado ‚úì";
        } else {
            alert("Permita o acesso para continuar.");
        }
    }, {scope:"ads_read,ads_management,business_management"});
}

// ----------------------- ONLOAD -----------------------
window.onload = function(){
    atualizarTabela();
    atualizarGrafico();
    atualizarGraficoProdutividade();
};
</script>

</body>
</html>
