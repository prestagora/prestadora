<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Plataforma de Marketing</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    margin: 0;
    background: #f4f6f9;
    font-family: Arial, sans-serif;
}

/* MENU LATERAL */
.sidebar {
    width: 250px;
    height: 100vh;
    background: #0d6efd;
    color: #fff;
    position: fixed;
    left: 0;
    top: 0;
    padding-top: 30px;
}
.sidebar h2 { text-align:center; margin-bottom:30px; font-size:20px; }
.sidebar a {
    display:block;
    padding:15px 20px;
    color:#fff;
    text-decoration:none;
    font-size:16px;
}
.sidebar a:hover { background:#0b5ed7; cursor:pointer; }

/* ÁREA PRINCIPAL */
.main { margin-left:250px; padding:30px; }
.card {
    background:#fff;
    padding:25px;
    border-radius:10px;
    box-shadow:0 0 12px rgba(0,0,0,0.1);
    margin-bottom:25px;
}
.topbar {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
    gap:10px;
}
.topbar h1 { margin:0; font-size:24px; color:#333; }

.btn {
    background:#0d6efd;
    border:none;
    padding:10px 20px;
    color:#fff;
    border-radius:6px;
    cursor:pointer;
    font-size:15px;
}
.btn:hover { background:#0b5ed7; }

/* CONTAS META ADS */
.seta { float:right; transition:0.3s; }
.contas-lista { margin-top:10px; padding-left:20px; display:none; }
.conta-item { padding:8px 0; }

/* DESPESAS + GRÁFICO */
.flex-container { display:flex; gap:30px; flex-wrap:wrap; }
.despesas-card, .grafico-card { flex:1; min-width:300px; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
th, td { padding:10px; border-bottom:1px solid #ddd; text-align:left; }
th { background-color:#f0f0f0; }
input[type="text"], input[type="number"], select {
    width:100%;
    padding:8px;
    margin:3px 0;
    border-radius:5px;
    border:1px solid #ccc;
}
#temporizador {
    font-weight:bold;
    margin-right:10px;
    min-width:80px;
    text-align:center;
}
</style>
</head>

<body>

<!-- MENU LATERAL -->
<div class="sidebar">
    <h2>Marketing ADS</h2>
    <a href="#">Dashboard</a>
    <a href="#contas" onclick="toggleContas()">Contas Meta Ads <span class="seta" id="seta">▼</span></a>
    <div class="contas-lista" id="listaContas"></div>
    <a href="meusclientes.html">Meus Clientes</a>
    <a href="#">Relatórios</a>
    <a href="#">Configurações</a>
    <a href="#" onclick="sair()">Sair</a>
</div>

<!-- ÁREA PRINCIPAL -->
<div class="main">

    <div class="topbar">
        <h1>Dashboard</h1>

        <!-- Temporizador -->
        <div style="display:flex; align-items:center; gap:5px;">
            <span id="temporizador">00:00:00</span>
            <button class="btn" id="btnStart">Iniciar Trabalho</button>
            <button class="btn" id="btnStop" style="display:none;">Parar</button>
        </div>

        <button class="btn" id="btnMeta" onclick="loginFacebook()">Conectar Meta Ads</button>
    </div>

    <div class="card">
        <h3>Bem-vindo à Plataforma de Marketing</h3>
        <p>Gerencie suas contas, campanhas e relatórios de forma automatizada.</p>
    </div>

    <!-- DESPESAS + GRÁFICO -->
    <div class="flex-container">

        <!-- TABELA DE DESPESAS -->
        <div class="despesas-card card">
            <h3>Minhas Despesas</h3>
            <label>Descrição</label>
            <input type="text" id="descDespesa" placeholder="Ex: Internet, Software...">
            <label>Categoria</label>
            <input type="text" id="catDespesa" placeholder="Ex: Tecnologia, Escritório...">
            <label>Valor (R$)</label>
            <input type="number" id="valDespesa" placeholder="0.00">
            <button class="btn" onclick="adicionarDespesa()">Adicionar Despesa</button>

            <table id="tabelaDespesas">
                <thead>
                    <tr>
                        <th>Descrição</th>
                        <th>Categoria</th>
                        <th>Valor (R$)</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- GRÁFICO -->
        <div class="grafico-card card">
            <h3>Receita vs Despesas</h3>
            <canvas id="grafico"></canvas>
        </div>

    </div>

</div>

<!-- SDK FACEBOOK -->
<script>
window.fbAsyncInit = function() {
    FB.init({
        appId: '1224065886236647',
        cookie: true,
        xfbml: true,
        version: 'v19.0'
    });
};
(function(d, s, id){
    let js, fjs = d.getElementsByTagName(s)[0];
    if(d.getElementById(id)) return;
    js=d.createElement(s); js.id=id;
    js.src="https://connect.facebook.net/pt_BR/sdk.js";
    fjs.parentNode.insertBefore(js,fjs);
}(document,'script','facebook-jssdk'));
</script>

<script>
// --- Variáveis Despesas ---
let despesas = JSON.parse(localStorage.getItem("despesas") || "[]");
let graficoChart;

// --- Funções Despesas ---
function adicionarDespesa(){
    const desc = document.getElementById("descDespesa").value;
    const cat = document.getElementById("catDespesa").value;
    const val = parseFloat(document.getElementById("valDespesa").value);
    if(!desc || !cat || isNaN(val)){ alert("Preencha todos os campos corretamente."); return; }
    despesas.push({desc, cat, val});
    localStorage.setItem("despesas", JSON.stringify(despesas));
    atualizarTabela();
    atualizarGrafico();
    document.getElementById("descDespesa").value="";
    document.getElementById("catDespesa").value="";
    document.getElementById("valDespesa").value="";
}

function atualizarTabela(){
    const tbody = document.querySelector("#tabelaDespesas tbody");
    tbody.innerHTML="";
    despesas.forEach((d,i)=>{
        tbody.innerHTML+=`<tr>
            <td>${d.desc}</td>
            <td>${d.cat}</td>
            <td>${d.val.toFixed(2)}</td>
            <td><button class="btn" style="background:red;padding:5px 10px;" onclick="removerDespesa(${i})">Excluir</button></td>
        </tr>`;
    });
}

function removerDespesa(index){
    despesas.splice(index,1);
    localStorage.setItem("despesas", JSON.stringify(despesas));
    atualizarTabela();
    atualizarGrafico();
}

// --- Receita (clientes cadastrados) ---
function calcularReceita(){
    const clientes = JSON.parse(localStorage.getItem("clientes") || "[]");
    let total = 0;
    clientes.forEach(c => {
        // Assume que cada cliente tem o campo "valor" que é o ganho do contrato
        const val = parseFloat(c.valor);
        if(!isNaN(val)) total += val;
    });
    return total;
}

// --- Gráfico ---
function atualizarGrafico(){
    const receita = calcularReceita();
    const totalDespesas = despesas.reduce((acc,d)=>acc + d.val,0);
    const ctx = document.getElementById("grafico").getContext("2d");
    const data = {
        labels:["Receita","Despesas"],
        datasets:[{label:"R$", data:[receita,totalDespesas], backgroundColor:["#0d6efd","#dc3545"]}]
    };
    if(graficoChart) graficoChart.destroy();
    graficoChart = new Chart(ctx,{type:'bar',data:data,options:{responsive:true,plugins:{legend:{display:false}}}});
}

// --- Temporizador ---
let horas=0, minutos=0, segundos=0, intervalo;
const spanTemp = document.getElementById("temporizador");
const btnStart = document.getElementById("btnStart");
const btnStop = document.getElementById("btnStop");

function atualizarTemporizador(){
    segundos++;
    if(segundos>=60){segundos=0; minutos++;}
    if(minutos>=60){minutos=0; horas++;}
    spanTemp.textContent = `${String(horas).padStart(2,'0')}:${String(minutos).padStart(2,'0')}:${String(segundos).padStart(2,'0')}`;
}

btnStart.onclick = function(){
    intervalo = setInterval(atualizarTemporizador,1000);
    btnStart.style.display="none";
    btnStop.style.display="inline-block";
}

btnStop.onclick = function(){
    clearInterval(intervalo);
    btnStart.style.display="inline-block";
    btnStop.style.display="none";
}

// --- Contas Meta Ads ---
function loginFacebook(){
    FB.login(response=>{
        if(response.status==='connected'){
            document.getElementById("btnMeta").innerText="Conectado ✓";
            carregarContasMeta();
        } else alert("Você precisa permitir o acesso para continuar.");
    },{scope:'ads_read,ads_management,business_management'});
}

function carregarContasMeta(){
    FB.api('/me/adaccounts', response=>{
        if(response && !response.error){
            localStorage.setItem("contas_meta",JSON.stringify(response.data));
            mostrarContas();
        } else alert("Erro ao carregar contas Meta Ads.");
    });
}

function mostrarContas(){
    const lista=document.getElementById("listaContas");
    lista.innerHTML="";
    const contas=JSON.parse(localStorage.getItem("contas_meta")||"[]");
    contas.forEach(c=>{ lista.innerHTML+=`<div class="conta-item">• ${c.name} (${c.account_id})</div>`; });
}

function toggleContas(){
    const lista=document.getElementById("listaContas");
    const seta=document.getElementById("seta");
    const aberto=lista.style.display==="block";
    lista.style.display=aberto?"none":"block";
    seta.style.transform=aberto?"rotate(0deg)":"rotate(180deg)";
}

// --- Inicialização ---
window.onload=function(){
    if(localStorage.getItem("contas_meta")){
        document.getElementById("btnMeta").innerText="Conectado ✓";
        mostrarContas();
    }
    atualizarTabela();
    atualizarGrafico();
}

// --- Logout ---
function sair(){
    localStorage.clear();
    alert("Você saiu da plataforma.");
    location.reload();
}
</script>

</body>
</html>
